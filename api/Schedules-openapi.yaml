openapi: 3.1.0
info:
  title: Schedules Service Vahta API
  description: "Документация API для микросервиса расписаний Вахта. Управление отв\
    етственными на день, расписанием кухни, ресурсов (качалка, инет и тд) и таймсл\
    отов"
  version: 1.0.0
servers:
- url: http://localhost:8084
  description: Generated server url
tags:
- name: Ответственные за ресурс
  description: Эндпоинты для работы с ответственными на день за различные ресурсы
paths:
  /responsibles:
    post:
      tags:
      - Ответственные за ресурс
      summary: Создать ответственного
      description: "Назначает указанного юзера ответственным за ресурс на указанны\
        й день. Если юзер не указан, то берется юзер, отправивший запрос"
      operationId: setResponsible
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResponsibleSetRequestDto"
        required: true
      responses:
        "201":
          description: Успешное создание (назначение) ответственного
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResponsibleResponseDto"
        "403":
          description: Нет прав управлять ответственными
        "409":
          description: "Нельзя назначить ответственного на указанный день, так как\
            \ нет слотов для записи. Или юзер уже назначен. Или нарушение ограниче\
            ний БД"
        "501":
          description: Неизвестный тип ответственного
        "500":
          description: Неизвестная ошибка сервера
        "400":
          description: "Неверный запрос от клиента, нарушение ограничений запроса\
            \ (тело, параметры)"
        "401":
          description: Запрос не авторизован
      security:
      - bearerAuth: []
    delete:
      tags:
      - Ответственные за ресурс
      operationId: deleteResponsible
      parameters:
      - name: responsibleId
        in: query
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "500":
          description: Неизвестная ошибка сервера
        "400":
          description: "Неверный запрос от клиента, нарушение ограничений запроса\
            \ (тело, параметры)"
        "401":
          description: Запрос не авторизован
        "204":
          description: No Content
  /schedules/kitchen/swap:
    patch:
      tags:
      - kitchen-schedule-controller
      operationId: swapDuties
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SwapRequestDto"
        required: true
      responses:
        "204":
          description: No Content
  /schedules/kitchen/mark/{kitchenScheduleId}:
    patch:
      tags:
      - kitchen-schedule-controller
      operationId: markDuty
      parameters:
      - name: kitchenScheduleId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "204":
          description: No Content
  /responsibles/{responsibleId}:
    patch:
      tags:
      - Ответственные за ресурс
      summary: Изменить ответственного
      description: "Меняет юзера, который будет ответственным за ресурс на день. Е\
        сли юзер не указан, то берется юзер, отправивший запрос"
      operationId: editResponsible
      parameters:
      - name: responsibleId
        in: path
        description: "ID ответственного (записи в БД, не юзера)"
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResponsibleEditRequestDto"
        required: true
      responses:
        "201":
          description: Успешное создание (назначение) ответственного
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResponsibleResponseDto"
        "403":
          description: Нет прав управлять ответственными
        "404":
          description: Ответственный не найден
        "409":
          description: Кто-то уже изменил ответственного во время выполнения запроса.
            Или юзер уже назначен. Или нарушение ограничений БД
        "500":
          description: Неизвестная ошибка сервера
        "400":
          description: "Неверный запрос от клиента, нарушение ограничений запроса\
            \ (тело, параметры)"
        "401":
          description: Запрос не авторизован
      security:
      - bearerAuth: []
  /schedules/kitchen:
    get:
      tags:
      - kitchen-schedule-controller
      operationId: getDutyById
      parameters:
      - name: kitchenScheduleId
        in: query
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KitchenScheduleResponseDto"
  /schedules/kitchen/get/on/room/{identifier}:
    get:
      tags:
      - kitchen-schedule-controller
      operationId: getActiveDuties
      parameters:
      - name: identifier
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ActiveEventResponseDto"
  /schedules/kitchen/get/on/floor:
    get:
      tags:
      - kitchen-schedule-controller
      operationId: getSchedule
      parameters:
      - name: floor
        in: query
        required: false
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/KitchenScheduleResponseDto"
  /schedules/kitchen/get/on/floor/date/{date}:
    get:
      tags:
      - kitchen-schedule-controller
      operationId: getDutyOnDate
      parameters:
      - name: date
        in: path
        required: true
        schema:
          type: string
          format: date
      - name: floor
        in: query
        required: false
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KitchenScheduleResponseDto"
  /schedules/available/timeslot/{date}/{bookingType}:
    get:
      tags:
      - timeslot-controller
      operationId: getAvailableTimeBooking
      parameters:
      - name: date
        in: path
        required: true
        schema:
          type: string
          format: date
      - name: bookingType
        in: path
        required: true
        schema:
          type: string
          enum:
          - HALL
          - INTERNET
          - GYM
          - KITCHEN
          - SOOP
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TimeslotResponse"
  /responsibles/one:
    get:
      tags:
      - Ответственные за ресурс
      summary: "Получить одного ответственного (для ресурсов, где может быть тольк\
        о один ответственный за день)"
      description: "Меняет юзера, который будет ответственным за ресурс на день. Е\
        сли юзер не указан, то берется юзер, отправивший запрос"
      operationId: getResponsible
      parameters:
      - name: date
        in: query
        required: true
        schema:
          type: string
          format: date
      - name: type
        in: query
        required: true
        schema:
          type: string
          enum:
          - HALL
          - INTERNET
          - GYM
          - KITCHEN
          - SOOP
      responses:
        "201":
          description: Успешное создание (назначение) ответственного
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserShortResponseDto"
        "403":
          description: Нет прав управлять ответственными
        "404":
          description: Ответственный не найден
        "409":
          description: Кто-то уже изменил ответственного во время выполнения запроса.
            Или юзер уже назначен. Или нарушение ограничений БД
        "500":
          description: Неизвестная ошибка сервера
        "400":
          description: "Неверный запрос от клиента, нарушение ограничений запроса\
            \ (тело, параметры)"
        "401":
          description: Запрос не авторизован
      security:
      - bearerAuth: []
  /responsibles/many:
    get:
      tags:
      - Ответственные за ресурс
      operationId: getAllResponsible
      parameters:
      - name: date
        in: query
        required: true
        schema:
          type: string
          format: date
      - name: type
        in: query
        required: true
        schema:
          type: string
          enum:
          - HALL
          - INTERNET
          - GYM
          - KITCHEN
          - SOOP
      responses:
        "500":
          description: Неизвестная ошибка сервера
        "400":
          description: "Неверный запрос от клиента, нарушение ограничений запроса\
            \ (тело, параметры)"
        "401":
          description: Запрос не авторизован
  /responsibles/active-event:
    get:
      tags:
      - Ответственные за ресурс
      operationId: getActiveResponsible
      responses:
        "500":
          description: Неизвестная ошибка сервера
        "400":
          description: "Неверный запрос от клиента, нарушение ограничений запроса\
            \ (тело, параметры)"
        "401":
          description: Запрос не авторизован
  /schedules/kitchen/{kitchenScheduleId}:
    delete:
      tags:
      - kitchen-schedule-controller
      operationId: deleteDuty
      parameters:
      - name: kitchenScheduleId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "204":
          description: No Content
components:
  schemas:
    ResponsibleSetRequestDto:
      type: object
      description: Тело запроса для назначения ответственного на день за ресурс
      properties:
        date:
          type: string
          format: date
          description: Дата дежурства (назначения ответственного)
        type:
          type: string
          description: Тип ответственного
          enum:
          - HALL
          - INTERNET
          - GYM
          - KITCHEN
          - SOOP
        user:
          type: string
          format: uuid
          description: "ID юзера, который будет назначен (опционально). Если не ук\
            азан, то берется текущий юзер (который отправил запрос)"
      required:
      - date
      - type
    ResponsibleResponseDto:
      type: object
      description: Ответ с описанием ответственного на день за ресурс
      properties:
        date:
          type: string
          format: date
          description: Дата назначения
        type:
          type: string
          description: Тип ответственного
          enum:
          - HALL
          - INTERNET
          - GYM
          - KITCHEN
          - SOOP
        user:
          type: string
          format: uuid
          description: "ID юзера, который назначен"
    SwapRequestDto:
      type: object
      properties:
        dutyId1:
          type: string
          format: uuid
        dutyId2:
          type: string
          format: uuid
      required:
      - dutyId1
      - dutyId2
    ResponsibleEditRequestDto:
      type: object
      description: Тело запроса изменения ответственного на день за ресурс
      properties:
        user:
          type: string
          format: uuid
          description: "ID юзера, который будет назначен ответственным за ресурс (о\
            пционально). Если не указать, то возьмется ID текущего юзера (отправив\
            шего запрос)"
    KitchenScheduleResponseDto:
      type: object
      properties:
        id:
          type: string
          format: uuid
        date:
          type: string
          format: date
        roomNumber:
          type: string
        checked:
          type: boolean
        users:
          type: array
          items:
            $ref: "#/components/schemas/UserShortResponseDto"
    UserShortResponseDto:
      type: object
      description: Ответ с краткой инфой о юзере (ФИО и ссылки на соцсети)
      properties:
        firstName:
          type: string
          description: Имя
        lastName:
          type: string
          description: Фамилия
        middleName:
          type: string
          description: Отчество
        tgLink:
          type: string
          description: Имя в ТГ
        vkLink:
          type: string
          description: Имя в ВК
    ActiveEventResponseDto:
      type: object
      description: Ответ с активным ивентом юзера
      properties:
        id:
          type: string
          format: uuid
          description: ID ивента
        startTime:
          type: string
          format: date-time
          description: Время старта ивента
        endTime:
          type: string
          format: date-time
          description: Врем конца ивента
        status:
          type: string
          description: Статус ивента
        type:
          type: string
          description: Тип ивента
    TimeslotResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        startTime:
          type: string
        endTime:
          type: string
        bookingCount:
          type: integer
          format: int32
        limit:
          type: integer
          format: int32
        isBookedByMe:
          type: boolean
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
